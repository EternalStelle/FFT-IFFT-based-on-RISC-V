# 设计方案
按照《计算机组成与设计：硬件软件接口（原书第5版·RISC-V版） (戴维 A.帕特森 (David A. Patterson) etc.)》的基础设计进行支持FFT/IFFT的RISC-V的CPU的设计。

该项目用于完成暨大FPGA课程的作业。
# 对FFT与IFFT的支持
## 采用了自定义指令集的方式完成设计，在R型指令的基础上进行修改。
| funct7 | 含义                           | funct7   | 含义 |
| ------ | ------------------------------| -------- | ---- |
| 0x10   | 加载第一个数，包含实数和虚数部分 | 0x1F     | 导出第三个FFT/IFFT实数运算结果     |
| 0x11   | 加载第二个数，包含实数和虚数部分 | 0x21     | 导出第三个FFT/IFFT虚数运算结果     |
| 0x12   | 加载第三个数，包含实数和虚数部分 | 0x22     | 导出第四个FFT/IFFT实数运算结果     |
| 0x13   | 加载第四个数，包含实数和虚数部分 | 0x23     | 导出第四个FFT/IFFT虚数运算结果     |
| 0x14   | 加载第五个数，包含实数和虚数部分 | 0x24     | 导出第五个FFT/IFFT实数运算结果     |
| 0x15   | 加载第六个数，包含实数和虚数部分 | 0x25     | 导出第五个FFT/IFFT虚数运算结果     |
| 0x16   | 加载第七个数，包含实数和虚数部分 | 0x26     | 导出第六个FFT/IFFT实数运算结果     |
| 0x17   | 加载第八个数，包含实数和虚数部分 | 0x27     | 导出第六个FFT/IFFT虚数运算结果     |
| 0x18   | 进行FFT第一次蝶形运算 | 0x28     | 导出第七个FFT/IFFT实数运算结果     |
| 0x19   | 进行FFT第二次蝶形运算 | 0x29     | 导出第七个FFT/IFFT虚数运算结果     |
| 0x1A   | 进行FFT第三次蝶形运算 | 0x2A     | 导出第八个FFT/IFFT实数运算结果     |
| 0x1B   | 导出第一个FFT/IFFT实数运算结果 | 0x2B     | 导出第八个FFT/IFFT虚数运算结果     |
| 0x1C   | 导出第一个FFT/IFFT虚数运算结果 | 0x2C     | 进行IFFT第一次蝶形运算     |
| 0x1D   | 导出第二个FFT/IFFT实数运算结果 | 0x2D     | 进行IFFT第一次蝶形运算     |
| 0x1E   | 导出第二个FFT/IFFT虚数运算结果 | 0x2E     | 进行IFFT第一次蝶形运算     |
## 使用定点数提高精度
在设计中，我将32位划分为三部分，最高位为符号位，表示正负；最低6位表示小数部分；中间的剩余比特位表示整数部分。比特位含义如下：
| MSB(31) | 30 | ......  | 7  | 6  | 5  | ......  | 7 |
| ------ | ----| ------ | ---- | ---- | ---- | ---- | ---- |
| 符号位   | $2^{24}$ |   -  | $2^1$ | $2^0$ | $2^{-1}$ | - | $2^{-6}$ |
# 使用方法
1. 计算前，使用RV32I已有的指令准备数据。
2. 使用上述表格中的funct7值编写准备计算的指令。例如，加载x1寄存器作为第1个数的实数部分和x2寄存器作为第1个数的虚数部分的指令可以写为：0010000_00010_00001_000_00000_0110011（二进制写法），即20208033（十六进制写法）。
3. 在加载好全部的8个数后（实数和虚数部分均加载好），我们可以手动输入三次蝶形运算指令进行计算。
4. 然后使用funct7值输入指令输出计算结果到寄存器中。
5. 在Questa中（这是我在Quartus中使用的软件），按上述的定点数格式更改显示格式来显示正确的结果。

** 所有的C语言文件只是用于验算结果，所有需要的Verilog文件均已在risc.v文件中导入。
